# 有限状态机FSM
- [有限状态机FSM](#有限状态机fsm)
  - [什么是有限状态机](#什么是有限状态机)
  - [有限状态机的实现](#有限状态机的实现)
  - [全局状态和状态翻转](#全局状态和状态翻转)
  - [有限状态机的消息功能](#有限状态机的消息功能)
    - [Telegram 消息的结构](#telegram-消息的结构)
    - [消息管理器 MessageDispatcher](#消息管理器-messagedispatcher)
    - [消息的处理](#消息的处理)
  - [常见智能体设计UML图](#常见智能体设计uml图)


## 什么是有限状态机
具有有限的状态，在任何瞬间只能处在一个状态中，并且可以在指定的时间根据输入，使得从一个状态转换成另一个状态。

## 有限状态机的实现
有限状态机中的状态可以是一个对象或者是函数
- 状态转换表
  - 各个状态意识不到其他状态的存在，通过外部的一个状态转换器，来控制状态的转换
- 内置规则
  - 状态内部定义了当前状态的转换规则，状态之间产生了耦合。但状态自身的状态转换不依赖任何的外部逻辑

## 全局状态和状态翻转
- 全局状态
  - 全局状态是指这样的一类状态，它们可以在智能体的任何状态任何时间之间发生，并且优先级最高，例如智能体的死亡，或者无法行动
- 状态翻转
  - 智能体有时可能需要返回到之前执行的状态中继续执行，这种行为被称为状态翻转

## 有限状态机的消息功能
在游戏中，智能体与智能体之间，智能体与玩家之间，智能体与环境之间都需要进行消息的传递，因此每一个状态都要实现消息的接受以及相应的处理功能。
实现消息传递的方法有多种，最简单的轮询，以及事件机制。

### Telegram 消息的结构
一个基本的消息，通常包含以下信息。**消息的结构应该是可重用的**
- 发送者
- 接受者
- 消息类型
- 时间戳
- 额外数据 - 主要包含发送者需要传递给接受者的数据

### 消息管理器 MessageDispatcher
消息的发送最好分配给一个特定的消息管理器来进行处理，该管理器必须能够访问到游戏中需要以及能够进行消息发送，接受和处理的实体。
并且能够对所有的消息进行统一的管理。

### 消息的处理
消息具体的处理应该深入到每一个状态中，因此智能体必须将消息向下传递，从 实体->状态机->状态


## 常见智能体设计UML图
![](/pic/AIUML.jpg)
